<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Invoice PDF - {{ id }}</title>
    <style>
        .invoice-box {
            max-width: 800px;
            margin: auto;
            padding: 30px;
            border: 1px solid #eee;
            box-shadow: none;
            font-size: 14px;
            line-height: 24px;
            color: #555;
        }
        .header { text-align: center; margin-bottom: 20px; }
        .header h1 { color: #3498db; margin-bottom: 5px; }
        .details, .total { margin-top: 20px; }
        table { width: 100%; line-height: inherit; text-align: left; border-collapse: collapse; }
        table td, table th { padding: 8px; vertical-align: top; border: 1px solid #ddd; }
        .seller, .buyer { width: 50%; float: left; }
        .status-box { background-color: #e6f7ff; padding: 10px; border-left: 5px solid #3498db; }
    </style>
</head>
<body>

<div class="invoice-box">
    <div class="header">
        <h1>ELECTRONIC INVOICE</h1>
        <p>No: {{ xml_tree.findtext("InvoiceNumber") }} | Date: {{ xml_tree.findtext("IssueDate") }}</p>
    </div>

    <div class="status-box">
        Verification Status: <strong>{{ invoice.verification_status }}</strong> (Downloading PDF triggers verification)
    </div>

    <div class="details clearfix">
        <div class="seller">
            <strong>Seller</strong><br>
            Name: {{ xml_tree.findtext("Seller/Name") }}<br>
            Tax Code: {{ xml_tree.findtext("Seller/TaxCode") }}<br>
            Address: {{ xml_tree.findtext("Seller/Address") }}
        </div>
        <div class="buyer">
            <strong>Buyer</strong><br>
            Name: {{ xml_tree.findtext("Buyer/Name") }}<br>
            Tax Code: {{ xml_tree.findtext("Buyer/TaxCode") }}<br>
            Address: {{ xml_tree.findtext("Buyer/Address") }}
        </div>
    </div>

    <table class="items">
        <thead>
            <tr class="heading">
                <th>Description</th>
                <th style="width: 10%">Qty</th>
                <th style="width: 20%; text-align: right;">Unit Price</th>
                <th style="width: 20%; text-align: right;">Amount</th>
            </tr>
        </thead>
        <tbody>
            {% for item in xml_tree.xpath('//Item') %}
            <tr class="item">
                <td>{{ item.findtext("Description") }}</td>
                <td>{{ item.findtext("Quantity") }}</td>
                <td style="text-align: right;">{{ item.findtext("UnitPrice") }}</td>
                <td style="text-align: right;">{{ item.findtext("Amount") }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <div class="total">
        Total: <strong>{{ xml_tree.findtext("TotalAmount") }} VND</strong>
    </div>
    
    <div style="margin-top: 50px;">
        Digital signature verified at: {{ invoice.created_at }}<br>
        Certificate: {{ invoice.common_name }} (Valid until: {{ invoice.valid_to }})
        <!-- QR code hiển thị SignatureValue và Public Key khi quét -->
        {% if qr_data_uri %}
        <div>
            <img src="{{ qr_data_uri }}" alt="QR Code" style="width:150px;height:150px;border:1px solid #ccc;" /><br>
            Scan to view Signature & Public Key
        </div>
        {% endif %}
    </div>
</div>

</body>
</html>